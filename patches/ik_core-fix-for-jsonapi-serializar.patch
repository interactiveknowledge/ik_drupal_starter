From d6746d8e22e7183ba6148e1a613a3f17879e7165 Mon Sep 17 00:00:00 2001
From: Rosemary Stanley <rosemary@interactiveknowledge.com>
Date: Thu, 1 Apr 2021 13:51:19 -0400
Subject: [PATCH] Patch our serializer to fix pagination

---
 .../src/Plugin/views/style/SerializerJsonApi.php      | 11 ++++++-----
 1 file changed, 6 insertions(+), 5 deletions(-)

diff --git web/modules/custom/ik_d8_module_core/src/Plugin/views/style/SerializerJsonApi.php web/modules/custom/ik_d8_module_core/src/Plugin/views/style/SerializerJsonApi.php
index 4d0501163..8cdc350ed 100644
--- web/modules/custom/ik_d8_module_core/src/Plugin/views/style/SerializerJsonApi.php
+++ web/modules/custom/ik_d8_module_core/src/Plugin/views/style/SerializerJsonApi.php
@@ -62,11 +62,15 @@ public function render() {
       $params['limit'] = $size;
     }
 
+    // Adds in additional pager details in case we want to show data in results (ex: "Showing 10 results of 91 total")
+    $current = (int) $params['offset'] / $params['limit'];
+    $pages = (int) $this->view->pager->getPagerTotal() + $current;
+
     $links = [
       'self' => $path . http_build_query($params),
     ];
 
-    if ($offset > 0) {
+    if ($current > 0) {
       $links['first'] = $path . http_build_query(array_merge(
         $params, ['offset' => 0, 'limit' => $size]
       ));
@@ -93,14 +97,11 @@ public function render() {
       ));
     }
 
-    // Adds in additional pager details in case we want to show data in results (ex: "Showing 10 results of 91 total")
-    $current = (int) $params['offset'] / $params['limit'];
-    $pages = (int) $this->view->pager->getPagerTotal() + $current;
-
     $pager = [ 
       'current' => $current,
       'items' => $total + ($current * $params['limit']),
       'pages' => $pages,
+      'offset' => $offset
     ];
 
     // Add in our exposed filters for output on front-end form.
-- 
2.24.3 (Apple Git-128)

